\chapter{Instalación y configuración de OpenMRS y Alfresco}
\section{OpenMRS}

\subsection{Sobre OpenMRS}


\begin{description}
\item OpenMRS

OpenMRS es una aplicación  bajo licencia GPL programada sobre el lenguaje Java que cumple diferentes funcionalidades de un sistema de registros médicos como: registro de pacientes, registro de especialistas, registro de encuentros entre paciente y especialista, generación de reportes, mantenedor de medicamentos y equipamiento en general.
\end{description}


\subsection{Obtener OpenMRS}

Se ingresa al sitio de descarga de OpenMRS:
\begin{center}\textbf{http://openmrs.org/wiki/Downloads}\end{center}

En la sección \textit{Official Releases} seleccionamos el fichero openmrs.war correspondiente a la última versión disponible para este caso esta corresponde a la versión 1.6.1.
\newline

Esto nos llevará a la siguiente URL en la cual debemos aceptar la licencia de OpenMRS antes de descargar.Utilziando esta URL realizamos la descarga.
\newline

\lstset{language=sh}
\begin{lstlisting}
root@localhost:  wget -b http://resources.openmrs.org/builds/releases/OpenMRS_1.6.1/openmrs.war
\end{lstlisting}

\subsection{Agregar como aplicación a GlassFish}

Se ingresa  al panel de administración de GlassFish en http://miserver.lazos.cl:4848/  \emph{(figura \ref{fig:panelglassfish})}.\newline

\begin{figure}
 \centering
 \includegraphics[width=15cm]{./images/panelglassfish.png}
 % panelglassfish.png: 1024x768 pixel, 72dpi, 36.12x27.09 cm, bb=0 0 1024 768
 \caption{Vista del ingreso al panel de administración de GlassFish}
 \label{fig:panelglassfish}
\end{figure}


Luego utilizando el nombre y password de usuario admin se ingresa  a Applications, Web Applications y click  en deploy. \emph{(figura \ref{fig:deployglassfish})}.\newline

\begin{figure}
 \centering
 \includegraphics[width=15cm]{./images/deployglassfish.png}
 % deployglassfish.png: 796x436 pixel, 72dpi, 28.08x15.38 cm, bb=0 0 796 436
 \caption{Vista del panel de administración en la pantalla deploy de GlassFish}
 \label{fig:deployglassfish}
\end{figure}

Se selecciona el fichero que contiene OpenMRS y se sube al servidor \emph{(figura \ref{fig:deployopenmrscontexto})}, en este momento existe la posibilidad de modificar el nombre y el contexto de la aplicación. Esto último hace referencia al nombre de la URL bajo el cual funcionará la aplicación OpenMRS que se ha instalado  y el contexto sobre el cual correrá. Si se desea agregar más de 1 OpenMRS al mismo dominio entonces este nombre y contexto deben ser modificados  antes de continuar.\newline


\begin{figure}
 \centering
 \includegraphics[width=15cm]{./images/deploypopenmrs.png}
 % deploypopenmrs.png: 916x491 pixel, 72dpi, 32.31x17.32 cm, bb=0 0 916 491
 \caption{Vista del panel de administración momentos antes de hacer deploy de la aplicación OpenMRS}
 \label{fig:deployopenmrscontexto}
\end{figure}

Se puede verificar que el deploy se realizó correctamente observando el log del proceso.

\newpage 
\subsection{Configurar OpenMRS con MySQL}

Se realiza una conexión a mysql con usuario root desde terminal:

\lstset{language=sh}
\begin{lstlisting}
root@localhost: Mysql -u root -p
\end{lstlisting}

Se crea una base de datos y usuario asociado asignando todos los privilegios.


\lstset{language=SQL}
\begin{lstlisting}
CREATE USER 'MINUEVOOPENMRS'@'localhost' IDENTIFIED BY '***';

GRANT USAGE ON * . * TO 'MINUEVOOPENMRS'@'localhost' IDENTIFIED BY '***' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0 ;

CREATE DATABASE IF NOT EXISTS `MINUEVOOPENMRS` ;

GRANT ALL PRIVILEGES ON `MINUEVOOPENMRS` . * TO 'MINUEVOOPENMRS'@'localhost';
\end{lstlisting}

Entrar por el navegador a la dirección http://miserver.lazos.cl:8080/openmrs y seguir los  pasos para la configuración.

\begin{itemize}
 \item Paso 1: Configuración de la base de datos: Se debe seleccionar la opción ``NO`` y proporcionar datos de usuario y contraseña de MySQL.

  \item Paso 2: Las primeras dos opciones en “SI” luego proporcionar usuario y contraseña de MySQL.

  \item Paso 3: Dejar las opciones por defecto y continuar

  \item Paso 4: Configurar una contraseña para administración, debe contener números y letras mayúsculas y minúsculas.

  \item Paso 5: Configurar una implementación y continuar

  \item Paso 6: Presionar Finish y esperar.
\end{itemize}


Con esto  OpenMRS queda configurado y listo para trabajar.

\subsection{Ingresando a OpenMRS}

Ingresamos desde el navegador a la URL: http://miserver.lazos.cl:8080/openmrs y luego ingresamos usuario y password configurados en la instalación. El navegador muestra la pantalla de la \emph{(figura \ref{fig:pantallainicialopenmrs})}.

\begin{figure}
 \centering
 \includegraphics[width=15cm]{./images/openmrs_pantallainicial.png}
 % openmrs_pantallainicial.png: 1280x800 pixel, 72dpi, 45.16x28.22 cm, bb=0 0 1280 800
 \caption{Vista de la pantalla de ingreso de OpenMRS}
 \label{fig:pantallainicialopenmrs}
\end{figure}

\section{Alfresco}


\subsection{Sobre Alfresco}

``Alfresco es un sistema de administración de contenidos libre, basado en estándares abiertos y de escala empresarial para sistemas operativos tipo Unix  y Otros. Está diseñado para usuarios que requieren un alto grado de modularidad y rendimiento escalable. Alfresco incluye un repositorio de contenidos, un framework de portal web para administrar y usar contenido estándar en portales, una interfaz CIFS  que provee compatibilidad de sistemas de archivos en Windows y sistemas operativos tipo Unix, un sistema de administración de contenido web capacidad de virtualizar aplicaciones web y sitios estáticos vía Apache Tomcat, búsquedas vía el motor Lucene y flujo de trabajo en jBPM. Alfresco está desarrollado en Java.'' \footnote{\url{http://es.wikipedia.org/wiki/Alfresco}}


\subsection{Obtener Alfresco y pre-requisitos}

\textbf{Obtener} el archivo war de alfresco “alfresco-community-war-3.3.tar.gz" del sitio:\\ \url{http://process.alfresco.com/ccdl/?file=release/community/build-2765/alfresco-community-war-3.3.tar.gz}
    \lstset{language=sh,label=alfresco_obteniendo}
    \begin{lstlisting}
      root@localhost: cd /tmp/ 
      root@localhost: tar vzxf alfresco-community-war-3.3.tar.gz
    \end{lstlisting}

Realizar los siguientes ajustes en MySQL (Debe estar instalado) 
    \lstset{language=sh,label=alfresco_entrandoAMYSQL}
    \begin{lstlisting}
    root@localhost: mysql -u root -p
    \end{lstlisting}

    \lstset{language=SQL,label=alfresco_CreandoBaseDatos}
    \begin{lstlisting}
    create database alfresco;
    create user 'NOMBRE_DE_USUARIO_ALFRESCO'@'localhost' identified by 'PASSWORD_USUARIO_ALFRESCO';
    grant all privileges on alfresco.* to 'NOMBRE_DE_USUARIO_ALFRESCO'@'localhost';
    \end{lstlisting}

\subsection{Configurar Alfresco}

Configurar Alfresco antes de deplegarlo en glassfish (hacer el deploy).Desde Alfresco 3,3, todos los ajustes ahora se basan en el archivo \textbf{alfresco-global.properties}. Este archivo se encuentra en el package de alfresco del \textbf{alfresco-community-war-3.3.tar.gz}. Este archivo \textbf{alfresco-global.properties} se copia desde la ubicación original hacia la ruta de destino donde glassfish lo reconocerá:

    \lstset{language=sh,label=alfresco_config}
    \begin{lstlisting}
    root@localhost: cp /alfresco-community-war-3.3/extensions/extension/alfresco-global.properties /home/glassfish/LiferayPortal/glassfish/domains/domain1/lib/classes/alfresco-global.properties
    \end{lstlisting}

Modificar este\textbf{ alfresco-global.properties} que se copió en el directorio : \textbf{glassfish/domains/domain1/lib/classes/} para configurar el acceso a la base de datos en alfresco. 
    \lstset{language=sh,label=alfresco_config}
    \begin{lstlisting}
		dir.root = /home/glassfish/LiferayPortal/
		db.username=NOMBRE_DE_USUARIO_ALFRESCO
		db.password=PASSWORD_USUARIO_ALFRESCO
		db.driver=org.gjt.mm.mysql.Driver
		db.url=jdbc:mysql://localhost/alfresco
    \end{lstlisting}

Crear un archivo ``sun-web.xml'' para la configuración de Alfresco.\newline

    \lstset{language=xml,label=sun-web_XML}
    \begin{lstlisting}
      <?xml version="1.0" encoding="UTF-8"?>
      <!DOCTYPE sun-web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Application Server 8.1 Servlet 2.4//EN" "http://www.sun.com/software/appserver/dtds/sun-web-app_2_4-1.dtd">
      <sun-web-app>
      <class-loader delegate="false"/>
      <property name="useMyFaces" value="true"/>
      </sun-web-app>
    \end{lstlisting}

Añadir el archivo ``sun-web.xml''  al archivo war de alfresco (alfresco.war). Para esto vamos al directorio ``\textbf{alfresco-community-war-3.3}'' (en donde se descomprimió el  \textbf{alfresco-community-war-3.3.tar.gz}. Crear aquí el directorio WEB-INF y dejar el sun-web.xml en esta carpeta. Luego se agrega este archivo xml al alfresco.war.\newline

    \lstset{language=sh}
    \begin{lstlisting}
  [root@localhost: tmp]# mkdir -p /alfresco-community-war-3.3/WEB-INF/
  [root@localhost:  tmp]# cp sun-web.xml /alfresco-community-war-3.3/WEB-INF/sun-web.xml
  [root@localhost:  tmp]# cd /alfresco-community-war-3.3/
  [root@localhost:  alfresco-community-war-3.3]# jar -uvf alfresco.war WEB-INF/*.xml
  [root@localhost:  alfresco-community-war-3.3]# chown glassfish:glassfish alfresco.war
  [root@localhost:  alfresco-community-war-3.3]# cp alfresco.war /tmp
    \end{lstlisting}


\subsection{Iniciar Alfresco}
Iniciar Servidor Glassfishv2.\newline

    \lstset{language=sh}
    \begin{lstlisting}
	[root@localhost:  alfresco-community-war-3.3]# service start glassfish 
	#esto siempre y cuando exista el fichero script en el directorio /etc/init.d/glassfish
    \end{lstlisting}

Hacer el despliegue (deploy) de alfresco.war en el servidor glassfishv2. Para esto iniciamos el servicio de glassfishv2, luego iniciamos el administrador y desde aquí integrar (hacer el deploy) de alfresco.war (que debería estar en /tmp/alfresco-community-war-3.3). \newline

\textbf{Iniciar alfresco: }Puede iniciarse desde el administrador de glassfis (Web aplication - deploy) aquí elegir el 	alfresco.war del directorio.




