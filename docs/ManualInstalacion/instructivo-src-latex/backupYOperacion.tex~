%Backup y operación de GlassFish 2
\chapter{Backup y operación de GlassFish 2}
\section{Sobre los dominios en GlassFish}

Antes que nada debes conocer de que trata el concepto de cominio en Glassfish:\newline

``Un dominio es un espacio de nombres de administración. Es un conjunto de  entidades en GlassFish las cuales pueden ser controladas por un administrador. Esto es llamado la tupla  Admin3T, que básicamente es un conjunto de \textbf{admin user, admin password, certificate database password (or master password)}. Si usted es un programador, no le importará la contraseña maestra que por  defecto es \textit{changeit}. Esta es la contraseña con la el cual su almacén de claves (cacerts.jks) está bloqueado y la mayoría de las veces no debería preocuparse de esto.''\footnote{\url{http://blogs.sun.com/bloggerkedar/entry/concept_of_a_glassfish_domain}} (Traducido).\newline

En función de esto entonces se buscará crear la tupla Admin3T para un usuario que desee un entorno aislado de pruebas bajo glassfish.

De acuerdo a esto entonces buscarás crear la tupla Admin3T para un usuario que desee un entorno aislado de pruebas bajo glassfish, posteriormente 

\section{Creando la tupla}



Vamos a ejecutar el intérprete de administración de glassfish 

\lstset{language=sh}
\begin{lstlisting}
root@localhost: export IND_D=/home/glassfish/GlassfishConGlassfish/LiferayPortal5_2_3/glassfish
root@localhost: export  MYSQL_SQL=/home/glassfish/liferay-portal-sql-5.2.3/create-minimal/create-minimal-mysql.sql 
root@localhost: cd $IND_D/bin
 ./asadmin 
Use "exit" to exit and "help" for online help.
asadmin>  list-domains

domain1 running
\end{lstlisting}

Observamos que solo existe un dominio creado y que esta activo. Ahora creamos el dominio el cual puede o no ocupar un puerto distinto para la administración. Dentro del intérprete creamos el dominio en este caso usamos un puerto distinto para panel: 


\lstset{language=sh}
\begin{lstlisting}
asadmin> create-domain --adminport 4849 sitiodistinto  

Please enter the admin user name>juan.perez
Please enter the admin password>eswindero

Please enter the admin password again>eswindero

Please enter the master password [Enter to accept the default]:>PassMAlmClaves
Please enter the master password again [Enter to accept the default]:>PassMAlmClaves
Using port 4849 for Admin.

Default port 8080 for HTTP Instance is in use. Using 40842

Default port 7676 for JMS is in use. Using 36251

Default port 3700 for IIOP is in use. Using 53722

Default port 8181 for HTTP_SSL is in use. Using 52767

Domain sitiodistinto created.
\end{lstlisting}
Ahora arrancamos el dominio previamente creado, si se ejecuta nuevamente ``asadmin - list-domains'' debería ver el dominio como no arrancado por tanto lo arrancaremos ahora. Dentro del intérprete creamos el dominio:



Luego vamos al navegador \url{http://localhost:4849/} (en este caso el puerto de administración que definimos era 4849) ponemos user y pass configuradas anteriormente y  vamos a Applications - Web Applications, le damos undeploy a  sevencogs-hook, wol-portlet, sevencogs-theme.


\section{Sobre respaldo y restauración de datos de Glassfish}

Glassfish provee una forma simple de respaldar, pero debes apagar el servicio de apache previamente, luego ejecutas lo siguiente para respaldar y restaurar copias de respaldo:

\textbf{Crear backup:}
\lstset{language=sh}
\begin{lstlisting}
root@localhost: cd  $GLASSFISH_HOME/bin
root@localhost: ./asadmin backup-domain --description "Este es un respaldo de prueba" domain1
\end{lstlisting}

\textbf{Restaura backup:}
\lstset{language=sh}
\begin{lstlisting}
root@localhost: cd  $GLASSFISH_HOME/bin
root@localhost: ./asadmin restore-domain  domain1
\end{lstlisting}